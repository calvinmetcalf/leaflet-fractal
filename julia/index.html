<!DOCTYPE html>
<html>
<head>
	<title>Julia Set Viewer</title>

   


     <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.css" />
    <style>
        body, html, #map {
            width: 100%;
            height: 100%;
            margin: 0px;
        }
        .leaflet-control-layers label {
            display:inline;
        }
    </style>   
    	<!--Fork Me on Github ribbon, we're using the awsome version from simonwhitaker available at https://github.com/simonwhitaker/github-fork-ribbon-css -->
<link rel="stylesheet" href="../gh-fork-ribbon.css" />
</head>

<body>	<div class="github-fork-ribbon-wrapper right">
<div class="github-fork-ribbon">
<a href="https://github.com/calvinmetcalf/leaflet-fractal">Fork me on GitHub</a>
</div>
</div>
	<div id="map"></div>
<script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>
	<script src="FractalLayer.js"></script>
	<script type="text/javascript">
        var map = L.map('map',{minZoom:1,zoomControl:false}).setView([0,0], 2);
        
      var JuliaControl = L.Control.extend({
    options: {
        position: 'topleft'
    },
formChange:function(map,defaults){
     var iters,cr,ci,values,inputs,len,i;
    if(defaults){
        values={};
        values.iterations = 500;
         values.cr = -0.37;
         values.ci = 0.6;
    }else{
         values={};
         inputs = document.getElementsByTagName("input");
         len = inputs.length;
         i = 0;
        while(i<len){
            values[inputs[i].name]=parseFloat(inputs[i].value,10);
            i++;
        }
        if(this.layer){
        map.removeLayer(this.layer);
        }
         iters = values.iterations;
         cr = values.cr;
         ci = values.ci;
    }
        this.layer = L.tileLayer.fractalLayer(6,"julia",values.iterations,values.cr,values.ci).addTo(map);
        history.pushState(values,"","#"+values.iterations+"/"+values.cr+"/"+values.ci);
    },
    onAdd: function (map) {
        // create the control container with a particular class name
        var container = L.DomUtil.create('div', 'leaflet-control-layers leaflet-control-layers-expanded leaflet-control');
        // ... initialize other DOM elements, add listeners, etc.
        var form = L.DomUtil.create("form","juliaForm", container);
        var defaultIter=500;
        var defaultCr=-0.37;
        var defaultCi=0.6;
        //form.dispatchFormChange()
        L.DomEvent.addListener(form,"change",function(e){
           this.formChange(map);
        },this);
        var hashes;
        if(location.hash){
            hashes=location.hash.slice(0,1)==="#"?location.hash.slice(1).split("/"):location.hash.split("/");
            this.layer = L.tileLayer.fractalLayer(6,"julia",parseFloat(hashes[0],10),parseFloat(hashes[1],10),parseFloat(hashes[2],10)).addTo(map);
            defaultIter=parseFloat(hashes[0],10);
            defaultCr=parseFloat(hashes[1],10);
            defaultCi=parseFloat(hashes[2],10);
        }else{
             this.formChange(map,true);
        }
        var _this=this;
        window.onpopstate = function(event) {
            if(event.state){
           document.getElementById("cr").value=event.state.cr;
        document.getElementById("ci").value=event.state.ci;
         document.getElementById("iter").value=event.state.iterations;
         map.removeLayer(_this.layer);
          _this.layer = L.tileLayer.fractalLayer(6,"julia",event.state.iterations,event.state.cr,event.state.ci).addTo(map);
        }};
       
        var crLabel = L.DomUtil.create("label","juliaLabel",form);
        crLabel.setAttribute("for","cr");
        crLabel.innerHTML="R: ";
        var cr = L.DomUtil.create("input","juliaInput",form);
        cr.setAttribute('id','cr');
        cr.setAttribute('type','number');
        cr.setAttribute('name','cr');
        cr.setAttribute('value',defaultCr);
        cr.setAttribute('min','-2');
        cr.setAttribute('max','2');
        cr.setAttribute('step','0.001');
       
        var ciLabel = L.DomUtil.create("label","juliaLabel",form);
        ciLabel.setAttribute("for","ci");
        ciLabel.innerHTML="I: ";
        var ci = L.DomUtil.create("input","juliaInput",form);
        ci.setAttribute('type','number');
        ci.setAttribute('name','ci');
        ci.setAttribute('id','ci');
        ci.setAttribute('value',defaultCi);
        ci.setAttribute('min','-2');
        ci.setAttribute('max','2');
        ci.setAttribute('step','0.001');
       
         var iterLabel = L.DomUtil.create("label","juliaLabel",form);
        iterLabel.setAttribute("for","iterations");
        iterLabel.innerHTML="Iterations: ";
        var iter = L.DomUtil.create("input","juliaInput",form);
         iter.setAttribute('type','number');
        iter.setAttribute('name','iterations');
        iter.setAttribute('value',defaultIter);
        iter.setAttribute('step','100');
        iter.setAttribute('min','0');
        iter.setAttribute('id','iter');
if (!L.Browser.touch) {
    		L.DomEvent.disableClickPropagation(container);
			L.DomEvent.on(container, 'mousewheel', L.DomEvent.stopPropagation);
		} else {
			L.DomEvent.on(container, 'click', L.DomEvent.stopPropagation);
		}
       
        return container;
    }
    
    
});

map.addControl(new JuliaControl());
	</script><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-31218444-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
