<!DOCTYPE html>
<html>
<head>
	<title>Leaflet TileLayer.Canvas with Web Workers example</title>

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>

	<script src="FractalLayer.js"></script>
    
    <style>
        body, html, #map {
            width: 100%;
            height: 100%;
            margin: 0px;
        }
        
    </style>
    	<!--Fork Me on Github ribbon, we're using the awsome version from simonwhitaker available at https://github.com/simonwhitaker/github-fork-ribbon-css -->
<link rel="stylesheet" href="../gh-fork-ribbon.css" />
</head>

<body>	<div class="github-fork-ribbon-wrapper right">
<div class="github-fork-ribbon">
<a href="https://github.com/calvinmetcalf/leaflet-fractal">Fork me on GitHub</a>
</div>
</div>
	<div id="map"></div>
<script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>
	<script src="FractalLayer.js"></script>
	<script type="text/javascript">
        var map = L.map('map',{minZoom:1,zoomControl:false}).setView([0, -90], 2);
        
      var JuliaControl = L.Control.extend({
    options: {
        position: 'topleft'
    },
formChange:function(map,defaults){
     var iters,cr,ci,values,inputs,len,i;
    if(defaults){
        values={};
        values.iterations = 500;
         values.cr = -0.37;
         values.ci = 0.6;
    }else{
         values={};
         inputs = document.getElementsByTagName("input");
         len = inputs.length;
         i = 0;
        while(i<len){
            values[inputs[i].name]=parseFloat(inputs[i].value,10);
            i++;
        }
        if(this.layer){
        map.removeLayer(this.layer);
        }
         iters = values.iterations;
         cr = values.cr;
         ci = values.ci;
    }
        this.layer = L.tileLayer.fractalLayer(6,"julia",values.iterations,values.cr,values.ci).addTo(map);
        history.pushState(values,"","#"+values.iterations+"/"+values.cr+"/"+values.ci);
    },
    onAdd: function (map) {
        // create the control container with a particular class name
        var container = L.DomUtil.create('div', 'leaflet-control-layers leaflet-control-layers-expanded leaflet-control');
        // ... initialize other DOM elements, add listeners, etc.
        var form = L.DomUtil.create("form","juliaForm", container);
        var defaultIter=500;
        var defaultCr=-0.37;
        var defaultCi=0.6;
        //form.dispatchFormChange()
        L.DomEvent.addListener(form,"change",function(e){
           this.formChange(map);
        },this);
        var hashes;
        if(location.hash){
            hashes=location.hash.slice(0,1)==="#"?location.hash.slice(1).split("/"):location.hash.split("/");
            this.layer = L.tileLayer.fractalLayer(6,"julia",parseFloat(hashes[0],10),parseFloat(hashes[1],10),parseFloat(hashes[2],10)).addTo(map);
            defaultIter=parseFloat(hashes[0],10);
            defaultCr=parseFloat(hashes[1],10);
            defaultCi=parseFloat(hashes[2],10);
        }else{
             this.formChange(map,true);
        }
        var ol = L.DomUtil.create("ul","jessicaList", form);
        var cr = L.DomUtil.create("input","juliaInput",L.DomUtil.create("li","item", ol));
        cr.setAttribute('type','number');
        cr.setAttribute('name','cr');
        cr.setAttribute('value',defaultCr);
        cr.setAttribute('min','-2');
        cr.setAttribute('max','2');
        cr.setAttribute('step','0.001');
        var ci = L.DomUtil.create("input","juliaInput",L.DomUtil.create("li","item", ol));
        ci.setAttribute('type','number');
        ci.setAttribute('name','ci');
        ci.setAttribute('value',defaultCi);
        ci.setAttribute('min','-2');
        ci.setAttribute('max','2');
        ci.setAttribute('step','0.001');
        
        var iter = L.DomUtil.create("input","juliaInput",L.DomUtil.create("li","item", ol));
         iter.setAttribute('type','number');
        iter.setAttribute('name','iterations');
        iter.setAttribute('value',defaultIter);
        iter.setAttribute('step','100');
        iter.setAttribute('min','0');
if (!L.Browser.touch) {
    		L.DomEvent.disableClickPropagation(container);
			L.DomEvent.on(container, 'mousewheel', L.DomEvent.stopPropagation);
		} else {
			L.DomEvent.on(container, 'click', L.DomEvent.stopPropagation);
		}
       
        return container;
    }
    
    
});

map.addControl(new JuliaControl());
	</script>
</body>
</html>
